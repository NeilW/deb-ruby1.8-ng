#! /bin/sh /usr/share/dpatch/dpatch-run
## 931_CVE-2009-0642.dpatch by akira yamada <akira@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad ruby1.8-1.8.7.72~/ext/openssl/ossl_ocsp.c ruby1.8-1.8.7.72/ext/openssl/ossl_ocsp.c
--- ruby1.8-1.8.7.72~/ext/openssl/ossl_ocsp.c	2007-06-09 00:02:04.000000000 +0900
+++ ruby1.8-1.8.7.72/ext/openssl/ossl_ocsp.c	2009-07-10 17:15:19.000000000 +0900
@@ -589,22 +589,22 @@
 static VALUE
 ossl_ocspbres_verify(int argc, VALUE *argv, VALUE self)
 {
-    VALUE certs, store, flags;
+    VALUE certs, store, flags, result;
     OCSP_BASICRESP *bs;
     STACK_OF(X509) *x509s;
     X509_STORE *x509st;
-    int flg, result;
+    int flg;
 
     rb_scan_args(argc, argv, "21", &certs, &store, &flags);
     x509st = GetX509StorePtr(store);
     flg = NIL_P(flags) ? 0 : INT2NUM(flags);
     x509s = ossl_x509_ary2sk(certs);
     GetOCSPBasicRes(self, bs);
-    result = OCSP_basic_verify(bs, x509s, x509st, flg);
+    result = OCSP_basic_verify(bs, x509s, x509st, flg) > 0 ? Qtrue : Qfalse;
     sk_X509_pop_free(x509s, X509_free);
     if(!result) rb_warn("%s", ERR_error_string(ERR_peek_error(), NULL));
 
-    return result ? Qtrue : Qfalse;
+    return result;
 }
 
 /*
